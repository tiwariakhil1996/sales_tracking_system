<div class="col-lg-12">
  <div class="card">
    <div class="card-header color">
      Activity Details
      <button type="submit" style="float: right;" class="btn btn-sm btn-success" (click)="addnewActivity()"><i
          class="fa fa-plus">Add</i></button>
    </div>
    <!-- <div>
  <input style="float: right; inline-size: max-content;" type="text" id="title" name="title" [(ngModel)]="update_activity.title" class="form-control" placeholder="Search">
</div> -->

    <!-- <div style="overflow-x:auto;"> -->
    <div class="card-body table-responsive">
      <!-- 
      <div class="form-inline md-form mr-auto mb-4">
        <input  style="float: right;" class="form-control mr-sm-2" id="title" name="title" (keyup)="onSearch(activity.aid)" type="text" placeholder="Search" aria-label="Search">
     
         <input  style="float: right;" class="form-control mr-sm-2" id="title" name="title" type="text" [(ngModel)]="search.title" placeholder="Search" aria-label="Search">

        <button  type="submit" (click)="Search()">Search</button> 

      </div> -->

      <table class="table table-bordered  btn-center">
        <thead>
          <tr class="table-success">
            <th>Sr.no</th>
            <th>Title</th>
            <th>Description</th>
            <th>Client</th>
            <th>Sales</th>
            <th>Contact</th>
            <th>Appointment Date</th>
            <th>Status</th>
            <th>Track</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of activityDetails;let i=index;">
            <td style="text-align: center">{{i+1}}</td>
            <!-- <td>{{item.aid}}</td> -->
            <td>{{item.title}}</td>
            <td>{{item.description}}</td>
            <!-- <td>{{item.productname}}</td> -->
            <td>{{item.clientName}}</td>
            <td>{{item.salesName}}</td>
            <td>{{item.contact}}</td>
            <td>{{item.appointmentDate}}</td>
            <td class="status-center">
              <span class="badge badge-pill badge-success">{{item.statusname}}</span>
            </td>
            <td>
              <i class="fa fa-map-marker map"  (click)="Get_Lat_Long_of_Activity(item.aid)" (click)="open_map_modal(map)"></i>
              <!-- <i class="fa fa-map-marker map" (click)="track_activity()" (click)="Get_Lat_Long_of_Activity(item.aid)" (click)="open_map_modal(map)"></i> -->

            </td>
            <td>
              <button type="button" class="btn btn-primary" data-toggle="modal" (click)="openupdatemodal(content,item)"
                (click)="GetProduct_Activity(item.aid)"><i class="fa fa-edit" aria-hidden="true"></i></button>

              <button class='btn btn-danger' type="button" (click)="onDelete(item.aid)"><i class="fa fa-trash"
                  aria-hidden="true"></i></button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>












<!--      EDIT Activity  -->

<ng-template #content let-modal>
  <div class="modal-header">
    <h4 id="dialog-sizes-name1" style="color: black;" class="modal-title pull-right">EDIT</h4>
    <div>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
  </div>

  <div class="modal-body" style="color: black;">

    <div class="form-group row">
      <div class="col-md-3">
        <label>Title</label>
        <input type="text" id="title" name="title" [(ngModel)]="update_activity.title" class="form-control">
      </div>
      <div class="col-md-2">
        <label for="select1">Client Name</label>
        <select name="clientName" class="form-control" [(ngModel)]="update_activity.clientId">
          <option [ngValue]="undefined">Select client Name</option>
          <option *ngFor="let item of clientDetails;" name="clientName" [ngValue]="item.id">{{item.clientName}}
          </option>
        </select>
      </div>
      <div class="col-md-2">
        <label for="select1">Sales Name</label>
        <select name="clientName" class="form-control" [(ngModel)]="update_activity.salesId">
          <option [ngValue]="undefined" selected>Select Sales Name</option>
          <option *ngFor="let item of salesDetails;" name="salesName" [ngValue]="item.id">{{item.salesName}}
          </option>
        </select>
      </div>

      <div class="col-sm-2">
        <label for="contact">Contact no.</label>
        <input type="text" class="form-control" id="contact" [(ngModel)]="update_activity.contact " name="contact "
          placeholder="Enter contact no.">
      </div>

      <div class="col-sm-2">
        <label class="text-input">Appointment Date</label>
        <input class="form-control" id="date" type="date" name="appointmentDate"
          [(ngModel)]="update_activity.appointmentDate">
      </div>

    </div>

    <div class="form-group row">
      <div class="col-md-6">
        <label>Description</label>
        <textarea type="text" id="description" name="description" [(ngModel)]="update_activity.description" rows="3"
          class="form-control" placeholder="Enter description"></textarea>
      </div>
      <div class="col-md-6">
      </div>
    </div>









    <!-- Add additional products -->

    <div class="card-body table-responsive">
      <!-- <table class="table table-bordered btn-center"> -->
      <table class="table">
        <thead>
          <!-- <tr class="table-success"> -->
          <tr>
            <th>Sr.no</th>
            <th>Product</th>
            <th>Price</th>
            <th>Qty*</th>
            <th>Amount</th>
            <th>Dis. (%)</th>
            <th>Dis amt</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>

          <tr *ngFor="let products of addproductlistDetails;let i=index;">
            <td>{{i+1}}</td>
            <td>
              <select id="productname" name="productname" class="form-control" [(ngModel)]="products.productId"
                (change)="onProductChange($event.target.value)">
                <option [ngValue]="undefined" selected>Select Product Name</option>
                <option *ngFor="let item of productDetails;" value={{item.id}}>{{item.productname}} </option>
              </select>
            </td>
            <td>
              <!-- <input *ngFor="let item of product_priceDetails;"  type="text" class="form-control" id="price" name="price" [(ngModel)]="item.price"  > -->
          <tr *ngFor="let item of product_priceDetails;">
            <td>
              {{item.price}}
            </td>
          </tr>
          <!-- <input type="text" class="form-control" id="price" name="price" [(ngModel)]="products.price"> -->
          </td>
          <td> <input type="text" class="form-control" id="quantity" name="quantity" [(ngModel)]="products.quantity">
          </td>
          <td> <input type="text" class="form-control" id="amount" name="amount" [(ngModel)]="products.amount">
          </td>
          <td> <input type="text" class="form-control" id="discount_per" name="discount_per"
              [(ngModel)]="products.discount_per">
          </td>
          <td> <input type="text" class="form-control" id="discount_amt" name="discount_amt"
              [(ngModel)]="products.discount_amt">
          </td>
          <td><input type="text" class="form-control" id="total_price" name="total_price"
              [(ngModel)]="products.total_price">
          </td>
          </tr>

        </tbody>
      </table>
    </div>

    <div class="form-group row">
      <div class="col-sm-1 add_product ">
        <button type="submit" class="form-control btn btn-sm btn-success" (click)="addMoreproducts()"><i
            class="fa fa-plus"></i> Add</button>
      </div>
    </div>






















    <!-- View Product List -->

    <div class="row">
      <div class="col-sm-12">
        <table class="table">
          <thead class="color">
            <tr>
              <th style="padding-right: 50px;">Action</th>
              <th>Sr.</th>
              <th>Product Name</th>
              <th>Price</th>
              <th>Qty</th>
              <th>Amt</th>
              <th>Dis. (%)</th>
              <th>Dis. Amt</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>


            <tr *ngFor="let products of activity_productDetails;let i=index;">
              <td> <button type="button" class="btn btn-primary" data-toggle="modal"
                  (click)="open_productupdatemodal(content1,products)">
                  <i class="fa fa-edit" aria-hidden="true"></i></button>

                <button class='btn btn-danger' type="button" (click)="onProductDelete(products.productId,products.aid)">
                  <i class="fa fa-trash" aria-hidden="true"></i></button>
              </td>
              <td>{{i+1}}</td>
              <td>
                {{products.productname}}
              </td>
              <td>
                {{products.price}}
              </td>
              <td>
                {{products.quantity}}
              </td>
              <td>
                {{products.amount}}
              </td>
              <td>
                {{products.discount_per}}
              </td>
              <td>
                {{products.discount_amt}}
              </td>
              <td>
                {{products.total_price}}
              </td>
            </tr>

          </tbody>
        </table>
      </div>
    </div>



    <!-- <div class="row">
      <div class="col-sm-12">
        <table class="table">
          <thead class="color">
            <tr>
              <th>Sr.</th>
            </tr>
          </thead>
          <tbody>
            <tr >
              <td></td>
            </tr>

          </tbody>
        </table>
      </div>
    </div> -->

  </div>



  <div class="card-footer">

    <button type="submit" class="btn btn-success" (click)="onEdit(update_activity.aid)">Update</button>
    <button type="button" class="btn btn-outline-info waves-effect ml-auto" data-dismiss="modal-body"
      (click)="modal.dismiss('Cross click')">Cancel</button>
  </div>
</ng-template>



















<!-- Edit Products in activity -->

<ng-template #content1 let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Update Product</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">

    <div class="form-group row">
      <!-- <div class="col-md-2">
        <label for="date">Product Name</label>
        <div class="input-group">
          <select id="productname" name="productname" class="form-control" [(ngModel)]="activity_product.productId"
            (change)="onProductChange($event.target.value)">
            <option [ngValue]="undefined" selected>Select Product Name</option>
            <option *ngFor="let item of productDetails;" value={{item.id}}>{{item.productname}} </option>
          </select>
        </div>
      </div> -->
      <div class="col-md-2">
        <label class="text-input">Product Name</label>
        <div class="form-inline">
          <select name="productname" class="form-control" name="productname" [(ngModel)]="activity_product.productId"
            (change)="onProductChange($event.target.value)">
            <option [ngValue]="undefined" selected>Select Product Name</option>
            <option *ngFor="let item of productDetails;" value={{item.cid}}>{{item.productname}}</option>
          </select>
        </div>
      </div>
      <div class="col-md-2">
        <!-- <div class="form-group"> -->
        <label>Price</label>
        <div class="input-group">
          <!-- <input *ngFor="let item of product_priceDetails;"  type="text" class="form-control" id="price" name="price" [(ngModel)]="item.price"  > -->
          <!-- <input type="text" class="form-control" id="price" name="price" [(ngModel)]="activity_product.price"> -->
          <tr *ngFor="let item of product_priceDetails;">
            <td>
              {{item.price}}
            </td>
          </tr>
        </div>
      </div>

      <div class="col-md-1">
        <!-- <div class="form-group"> -->
        <label>Quantity</label>
        <div class="input-group">
          <input type="text" class="form-control" id="quantity" name="quantity" [(ngModel)]="activity_product.quantity">
        </div>
      </div>

      <div class="col-md-2">
        <!-- <div class="form-group"> -->
        <label>Amount</label>
        <div class="input-group">
          <input type="text" class="form-control" id="amount" name="amount" [(ngModel)]="activity_product.amount">
        </div>
      </div>

      <div class="col-md-1">
        <!-- <div class="form-group"> -->
        <label>Dis. (%)</label>
        <div class="input-group">
          <input type="text" class="form-control" id="discount_per" name="discount_per"
            [(ngModel)]="activity_product.discount_per">
        </div>
      </div>

      <div class="col-md-2">
        <!-- <div class="form-group"> -->
        <label>Dis. amt</label>
        <div>
          <input type="text" class="form-control" id="discount_amt" name="discount_amt"
            [(ngModel)]="activity_product.discount_amt">
        </div>
      </div>

      <div class="col-md-2">
        <!-- <div class="form-group"> -->
        <label>Total</label>
        <div>
          <input type="text" class="form-control" id="total_price" name="total_price"
            [(ngModel)]="activity_product.total_price">
        </div>
      </div>

    </div>
  </div>
  <!-- </form> -->

  <div class="modal-footer">
    <!-- <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Save</button> -->
    <!-- <button type="button" class="btn btn-outline-dark" (click)="update_ToFollowup(activity.aid)">Submit</button> -->
    <button type="button" class="btn btn-outline-dark"
      (click)="Update_old_Products(activity_product.aid)">Submit</button>

  </div>
</ng-template>


<!-- <ng-template #map let-modal>
  <div class="modal-header">
  </div>
  <div class="modal-body" style="color: black;">
    <div>
      <div>
      <div class="agm-map">
        <agm-map #map [zoom]="16" [latitude]="centerlat" [longitude]="centerlng">
          <agm-marker [opacity]=0.8 [latitude]="lat" [longitude]="lng" [markerDraggable]="false"></agm-marker>
        </agm-map>
      </div>
        
        <h5>Address: {{address}}</h5>
        <div>Latitude: {{lat}}</div>
        <div>Longitude: {{lng}}</div>

    </div>
  </div>
  </div>
</ng-template> -->


<ng-template #map let-modal>
  <!-- <div class="modal-header">
  </div> -->
  <div class="modal-body" style="color: black;">
    <div>
      <div>
      <div class="agm-map" *ngFor="let addr of Activity_LocationDetails;">
        <agm-map #map [zoom]="16" [latitude]="centerlat" [longitude]="centerlng">
          <!-- Admin Location -->
          <agm-marker [label]="_admin" [opacity]=0.8 [latitude]="lat" [longitude]="lng" [markerDraggable]="false"></agm-marker>
          
          <!-- Sales Location -->
          <agm-marker [label]="_sales" [opacity]=0.8 [latitude]="addr.latitude" [longitude]="addr.longitude" [markerDraggable]="false"></agm-marker>

          <!-- Client Location -->
          <agm-marker [label]="_client" [opacity]=0.8 [latitude]="addr.lat" [longitude]="addr.lng" [markerDraggable]="false"></agm-marker>

        </agm-map>

        <div class="form-group row">
          <div class="col-md-3">
            <h5> Sales</h5>
            <div>Latitude: {{addr.latitude}}</div>
            <div>Longitude: {{addr.longitude}}</div>
          </div>
          <div class="col-md-3">
            <h5> Client</h5>
            <div>Latitude: {{addr.lat}}</div>
            <div>Longitude: {{addr.lng}}</div>
          </div>

          <!-- <div class="col-md-3">
            <div>Admin</div>
            <div>Sales</div>
            <div>Client</div>
          </div> -->

         <div>
          
          <table class="table-bordered named">
            <tbody>
              <tr>
                <td class="marker_tag">A</td>
                <td>Admin</td>
              </tr>
              <tr>
                <td  class="marker_tag">S</td>
                <td>Sales</td>
              </tr>
              <tr>
                <td  class="marker_tag">C</td>
                <td>Client</td>
              </tr>
            </tbody>
          </table>
        
         </div>

        </div>
        
      </div>
        
    </div>
  </div>
  </div>
</ng-template>